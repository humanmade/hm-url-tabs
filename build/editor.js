(()=>{"use strict";const t=window.wp.i18n,i=window.wp.blockEditor,e=window.wp.components,a=window.wp.hooks,n=window.wp.compose,l=window.wp.data,s=window.ReactJSXRuntime;(0,a.addFilter)("blocks.registerBlockType","hm-url-tabs/add-navigation-link-attributes",function(t,i){return"core/navigation-link"!==i?t:{...t,attributes:{...t.attributes,tabEndpoint:{type:"string",default:"tab"}}}}),(0,a.addFilter)("blocks.registerBlockType","hm-url-tabs/add-tab-visibility-attributes",function(t){return"core/navigation-link"===t.name?t:{...t,attributes:{...t.attributes,hmUrlTabVisibility:{type:"object",default:{condition:"always",endpoint:"tab",tabUrl:""}}}}});const o=(0,n.createHigherOrderComponent)(a=>n=>{const{attributes:l,setAttributes:o,name:r}=n;if("core/navigation-link"!==r||!l?.kind||!["tab","tab-base","tab-home"].includes(l.kind))return(0,s.jsx)(a,{...n});const b=window.hmUrlTabsData?.endpoints?.map(t=>t.name)||[];if(b.length<=1)return(0,s.jsx)(a,{...n});const{tabEndpoint:d="tab"}=l;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a,{...n}),(0,s.jsx)(i.InspectorControls,{children:(0,s.jsx)(e.PanelBody,{title:(0,t.__)("Tab Settings","hm-url-tabs"),initialOpen:!0,children:(0,s.jsx)(e.SelectControl,{label:(0,t.__)("Endpoint","hm-url-tabs"),value:d,options:b.map(t=>({label:t,value:t})),onChange:t=>o({tabEndpoint:t}),help:(0,t.__)("The URL endpoint this tab uses.","hm-url-tabs")})})})]})},"withTabEndpointSelector");(0,a.addFilter)("editor.BlockEdit","hm-url-tabs/tab-endpoint-selector",o);const r=(0,n.createHigherOrderComponent)(a=>n=>{const{attributes:o,setAttributes:r,name:b,clientId:d}=n;if(!o||"core/navigation-link"===b)return(0,s.jsx)(a,{...n});const{hmUrlTabVisibility:c={}}=o,{condition:u="always",endpoint:h="tab",tabUrl:p=""}=c,m=window.hmUrlTabsData?.endpoints?.map(t=>t.name)||["tab"],w=m.length>1,{tabs:k,hasParentWithVisibility:y}=(0,l.useSelect)(t=>{const{getBlocksByName:i,getBlock:e,getBlockParents:a,hasSelectedInnerBlock:n}=t("core/block-editor"),l=i("core/navigation-link"),s=new Set;return{tabs:l.map(t=>e(t)).filter(t=>"tab"===t?.attributes?.kind||"tab-home"===t?.attributes?.kind||"tab-base"===t?.attributes?.kind).map(t=>({label:t.attributes.label||"",url:t.attributes.url||"",endpoint:t.attributes.tabEndpoint||"tab",isHomeTab:"tab-home"===t.attributes.kind,isBaseTab:"tab-base"===t.attributes.kind})).filter(t=>{const i=`${t.endpoint}:${t.url}:${t.isHomeTab}:${t.isBaseTab}`;return!s.has(i)&&(s.add(i),!0)}),hasParentWithVisibility:a(d).some(t=>{const i=e(t);return i?.attributes?.hmUrlTabVisibility?.condition&&"always"!==i.attributes.hmUrlTabVisibility.condition}),hasSelectedInnerBlock:n(d,!0)}},[d]);if(0===k.length)return(0,s.jsx)(a,{...n});if(y)return(0,s.jsx)(a,{...n});const g=k.filter(t=>t.endpoint===h);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a,{...n}),(0,s.jsx)(i.InspectorControls,{children:(0,s.jsxs)(e.PanelBody,{title:(0,t.__)("Tab Visibility","hm-url-tabs"),initialOpen:!1,children:[(0,s.jsx)(e.SelectControl,{label:(0,t.__)("Display Condition","hm-url-tabs"),value:u,options:[{label:(0,t.__)("Always show","hm-url-tabs"),value:"always"},{label:(0,t.__)("Show when no endpoint is active","hm-url-tabs"),value:"no-endpoint"},{label:(0,t.__)("Show when endpoint has no value","hm-url-tabs"),value:"endpoint-empty"},{label:(0,t.__)("Show for specific tab","hm-url-tabs"),value:"specific-tab"}],onChange:t=>{const i={...c,condition:t};"always"!==t&&"no-endpoint"!==t||(delete i.endpoint,delete i.tabUrl),"endpoint-empty"!==t&&"specific-tab"!==t||i.endpoint||(i.endpoint=m[0]||"tab"),r({hmUrlTabVisibility:i})}}),w&&(0,s.jsx)(e.SelectControl,{label:(0,t.__)("Endpoint","hm-url-tabs"),value:h,options:m.map(t=>({label:t,value:t})),onChange:t=>r({hmUrlTabVisibility:{...c,endpoint:t}})}),"specific-tab"===u&&(0,s.jsx)(e.SelectControl,{label:(0,t.__)("Tab","hm-url-tabs"),value:p,options:[{label:(0,t.__)("Select a tabâ€¦","hm-url-tabs"),value:""},...g.filter(t=>!t.isHomeTab&&!t.isBaseTab).map(t=>({label:t.label||t.url,value:t.url}))],onChange:t=>r({hmUrlTabVisibility:{...c,tabUrl:t}}),help:(0,t.__)("This block will only be visible when the selected tab is active.","hm-url-tabs")})]})})]})},"withTabVisibilityControls");(0,a.addFilter)("editor.BlockEdit","hm-url-tabs/tab-visibility-controls",r);const b=(0,n.createHigherOrderComponent)(t=>i=>{const{name:e,clientId:a}=i;if("core/navigation-link"===e)return(0,s.jsx)(t,{...i});const{tabs:n,hasVisibility:o}=(0,l.useSelect)(t=>{var i;const{getBlocksByName:e,getBlock:n}=t("core/block-editor"),l=e("core/navigation-link").map(t=>n(t)).filter(t=>"tab"===t?.attributes?.kind||"tab-home"===t?.attributes?.kind||"tab-base"===t?.attributes?.kind),s=n(a),o=s?.attributes?.hmUrlTabVisibility;return{tabs:l,hasVisibility:"always"!==(null!==(i=o?.condition)&&void 0!==i?i:"always")}},[a]);return o&&n.length>0?(0,s.jsx)(t,{...i,className:"wp-block-has-hm-tab-visibility"}):(0,s.jsx)(t,{...i})},"withTabVisibilityIndicator");(0,a.addFilter)("editor.BlockListBlock","hm-url-tabs/tab-visibility-indicator",b)})();